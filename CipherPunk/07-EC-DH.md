## EC-DH, Elliptic Curve Diffie-Hellman Encryption-Key Change

**EC-DH** (***Elliptic Curve Diffie-Hellman***) is a key agreement protocol used to establish a shared secret key over an insecure communication channel. It is similar to the traditional Diffie-Hellman protocol, but instead of using finite fields, it uses elliptic curve cryptography. The protocol involves the following steps:

1. Both parties agree on a standard elliptic curve and base point of that curve.
2. Both parties generate a private key represented by a random integer value between 1 and n-1, where n is the order of the base point.
3. Both parties exchange their public keys, which are generated by multiplying the base point by the private key. The result is a point on the curve.
4. Each party computes the shared secret by multiplying their own private key with the other party's public key. The result is a point on the curve.
5. The shared secret is derived from the x-coordinate of the computed point using a one-way hash function.

The mathematics involved in EC-DH can be represented as follows:

Let's assume that Alice and Bob want to establish a shared secret key using **EC-DH**. They both agree on a standard elliptic curve with the equation: `y^2 = x^3 + ax + b (mod p)`, where a, b, and p are constants. They also agree on a base point G, which is a point on the curve, and its order n.

1. Alice generates a private key 'aA', which is a random integer between '1 and n-1'.
2. Alice computes her public key 'QA' by multiplying the base point 'G' with her private key: 'QA = aA * G'.
3. Bob generates a private key 'bB', which is a random integer between '1 and n-1'.
4. Bob computes his public key 'QB' by multiplying the base point 'G' with his private key: 'QB = bB * G'.
5. Alice sends her public key 'QA' to Bob, and Bob sends his public key 'QB' to Alice.
6. Alice computes the shared secret 'S' by multiplying Bob's public key 'QB' with her private key 'aA: S = aA * QB'.
7. Bob computes the shared secret 'S' by multiplying Alice's public key 'QA' with his private key 'bB: S = bB * QA'.
8. The shared secret is derived from the x-coordinate of the computed point using a one-way hash function: 'K = H(S.x)'.

Here is an example code in JavaScript showing how to perform **EC-DH** using the elliptic library:

```js
// nodejs
const elliptic = require('elliptic');

// Choose a standard elliptic curve (secp256k1 is commonly used in Bitcoin)
const curve = elliptic.curves.secp256k1;

// Generate Alice's private key
const aA = elliptic.randInt(curve.n);

// Generate Alice's public key
const QA = curve.g.mul(aA);

// Generate Bob's private key
const bB = elliptic.randInt(curve.n);

// Generate Bob's public key
const QB = curve.g.mul(bB);

// Alice sends her public key to Bob, and Bob sends his public key to Alice

// Alice computes the shared secret
const S1 = QB.mul(aA);

// Bob computes the shared secret
const S2 = QA.mul(bB);

// Derive the shared secret key from the x-coordinate of the computed point
const K = elliptic.utils.sha256(Buffer.from(S1.getX().toArray().concat(S1.getY().toArray(), 'be'), 'hex')).toString('hex');

console.log(K);
```

In this example code, Alice and Bob generate their private and public keys using the elliptic library. They then exchange their public keys and compute the shared secret using the `mul` method, which performs scalar multiplication on the curve. Finally, they derive the shared secret key using the x-coordinate of the computed point and a one-way hash function.
